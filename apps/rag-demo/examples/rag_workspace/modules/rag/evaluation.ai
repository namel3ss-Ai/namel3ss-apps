flow "run_eval_smoke": requires true
  let query_text is "What is in the latest uploaded document?"
  let has_query is false
  try:
    set query_text is input.query
    set has_query is true
  with catch err:
    set has_query is false

  if has_query is false or query_text is null or query_text is "":
    set query_text is "What is in the latest uploaded document?"

  let out is call pipeline "retrieval":
    input:
      query is query_text
      limit is 1
    output:
      report

  let report is out.report
  let results is list:
  try:
    set results is report.results
  with catch err:
    set results is list:

  let source_count is list length of results
  let coverage is 0
  if source_count is greater than 0:
    set coverage is 1

  let eval_status is "no_answer"
  if source_count is greater than 0:
    set eval_status is "answered"

  set state.eval_record with:
    query is query_text
    status is eval_status
    source_count is source_count
    coverage is coverage
  create "EvalRun" with state.eval_record as eval_record

  set state.explain_entry with:
    stage is "evaluation"
    detail is map:
      "query" is query_text
      "status" is eval_status
      "source_count" is source_count
      "coverage" is coverage
  create "ExplainEntry" with state.explain_entry as explain_entry

  return map:
    "status" is eval_status
