# How to Extend the Demo

This guide keeps extensions deterministic and inspectable.

For short task-focused guides, see `docs/recipes/`.

## Add a new source type

1. Ensure upload MIME type is accepted in `app.ai` upload intake.
2. Keep ingestion through runtime pipelines.
3. Add deterministic metadata mapping to `DocumentLibrary`.
4. Add a golden eval case that exercises the new source.

## Add a retrieval feature

1. Extend deterministic query profile or lexical scoring logic.
2. Keep all ranking rules explicit in flow code.
3. Record decisions in `RankingDecision` and `RetrievalCandidate`.
4. Update `ExplainSummary` if you add new ranking policies.

## Add eval coverage

1. Append a case in `eval/golden.json`.
2. Include expected themes and citation constraints.
3. Run `python3 eval/run_eval.py --offline`.
4. If intentionally better, refresh `eval/report_baseline.json`.

## Add docs safely

Keep docs consistent with runtime behavior:

- no claims about hidden logic
- no unverifiable quality claims
- include exact local commands that were tested

## Optional URL snapshots

Use `scripts/fetch_url_snapshot.py` for controlled URL ingestion:

1. Set `RAG_URL_ALLOWLIST`.
2. Fetch snapshot text into `assets/url_snapshots/`.
3. Upload snapshot files through normal upload + ingestion flow.

The manifest generated by the script keeps deterministic source provenance.
